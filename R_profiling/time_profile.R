# Read in example simulation data
sim_share <- readRDS(file='sim_share.RDS')

# Start the R profiler
Rprof()
# Run the model with simulated data
searchOptimalConfiguration(
  baseline_tree = paintSubTree(
    reorder(as.phylo(sim_share[[1]]$paintedTree), order = 'postorder'),
    node = length(sim_share[[1]]$paintedTree$tip.label) + 1,
    state = 0
  ),
  trait_data = sim_share[[1]]$simulatedData,
  formula = 'trait_data ~ 1',
  min_descendant_tips = 10,
  num_cores = 8,
  shift_acceptance_threshold = 20,
  plot = T,
  IC = 'GIC',
  store_model_fit_history = FALSE,
  method = 'LL'
)
# Stop the profiler
Rprof(NULL)
# Look at the results
summaryRprof()

'
$by.self
self.time self.pct total.time total.pct
"pruning"                        66.74    38.88      69.66     40.58
"crossprod"                      35.52    20.69      35.52     20.69
"serialize"                      12.72     7.41      12.72      7.41
".Call"                           6.46     3.76       6.46      3.76
"eigen"                           3.96     2.31       4.08      2.38
"%*%"                             3.28     1.91       3.28      1.91
"socketSelect"                    3.00     1.75       3.00      1.75
"plot.xy"                         2.98     1.74       6.08      3.54
"$"                               2.72     1.58       4.78      2.78
".External2"                      2.50     1.46     122.14     71.15
"drop.tip.simmap"                 2.06     1.20      11.28      6.57
"save"                            1.34     0.78       1.50      0.87
"t"                               1.20     0.70       2.76      1.61
"unserialize"                     1.06     0.62       1.06      0.62
".transformTree"                  1.02     0.59     108.16     63.01
"fn"                              0.92     0.54     119.40     69.56
"base::backsolve"                 0.90     0.52       2.50      1.46
"as.matrix"                       0.86     0.50       1.04      0.61
"La.svd"                          0.84     0.49       1.62      0.94
"plotPhylogram"                   0.82     0.48      11.12      6.48
"which"                           0.80     0.47       1.24      0.72
"t.default"                       0.78     0.45       0.78      0.45
"c"                               0.74     0.43       0.74      0.43
"standardGeneric"                 0.72     0.42       3.94      2.30
"lapply"                          0.64     0.37      14.34      8.35
"as.list"                         0.62     0.36       0.80      0.47
"$<-"                             0.56     0.33       1.02      0.59
"Ntip"                            0.56     0.33       0.90      0.52
"FUN"                             0.54     0.31      14.42      8.40
"gc"                              0.52     0.30       0.52      0.30
"<Anonymous>"                     0.48     0.28     120.38     70.13
"is.binary.phylo"                 0.46     0.27       1.16      0.68
"unlist"                          0.44     0.26       0.94      0.55
"tabulate"                        0.44     0.26       0.46      0.27
"paste"                           0.42     0.24       0.44      0.26
"lines"                           0.40     0.23       7.04      4.10
"svd"                             0.40     0.23       2.80      1.63
"paste0"                          0.40     0.23       0.54      0.31
"psmall.svd"                      0.36     0.21       3.54      2.06
"par"                             0.36     0.21       1.92      1.12
"apply"                           0.36     0.21       1.62      0.94
"base::determinant"               0.36     0.21       0.82      0.48
"mode<-"                          0.34     0.20       1.14      0.66
"chol"                            0.32     0.19       1.10      0.64
"xy.coords"                       0.30     0.17       0.90      0.52
"isTRUE"                          0.30     0.17       0.34      0.20
"determinant"                     0.28     0.16       1.18      0.69
"%in%"                            0.28     0.16       0.38      0.22
"diag"                            0.24     0.14       0.94      0.55
"backsolve"                       0.22     0.13       2.72      1.58
"setdiff"                         0.22     0.13       1.52      0.89
"determinant.matrix"              0.22     0.13       0.24      0.14
"fast.svd"                        0.20     0.12       3.74      2.18
"matrix"                          0.20     0.12       1.54      0.90
"paintSubTree_mod"                0.20     0.12       1.04      0.61
"chol.default"                    0.20     0.12       0.52      0.30
".External"                       0.18     0.10       0.18      0.10
"is.finite"                       0.18     0.10       0.18      0.10
"sum"                             0.18     0.10       0.18      0.10
"doTryCatch"                      0.16     0.09     157.46     91.73
"duplicated"                      0.16     0.09       0.78      0.45
"length"                          0.16     0.09       0.16      0.09
"tryCatch"                        0.14     0.08     157.46     91.73
"lines.default"                   0.14     0.08       6.22      3.62
"pseudoinverse"                   0.14     0.08       4.16      2.42
"paintSubTree"                    0.14     0.08       0.44      0.26
"duplicated.default"              0.14     0.08       0.38      0.22
"ifelse"                          0.14     0.08       0.26      0.15
"names"                           0.14     0.08       0.14      0.08
"strwidth"                        0.14     0.08       0.14      0.08
"tryCatchList"                    0.12     0.07     157.46     91.73
".corrStr"                        0.12     0.07     108.36     63.12
"all"                             0.12     0.07       0.12      0.07
"list"                            0.12     0.07       0.12      0.07
"get"                             0.10     0.06       0.66      0.38
".is.rooted_ape"                  0.10     0.06       0.36      0.21
"nrow"                            0.10     0.06       0.32      0.19
"ncol"                            0.10     0.06       0.12      0.07
"is.factor"                       0.10     0.06       0.10      0.06
"tryCatchOne"                     0.08     0.05     157.46     91.73
"getDescendants"                  0.08     0.05       0.32      0.19
".vec"                            0.08     0.05       0.18      0.10
"match.fun"                       0.08     0.05       0.10      0.06
"vcv.phylo"                       0.08     0.05       0.10      0.06
"as.list.default"                 0.08     0.05       0.08      0.05
"attr"                            0.08     0.05       0.08      0.05
"double"                          0.08     0.05       0.08      0.05
"gzfile"                          0.08     0.05       0.08      0.05
"substr"                          0.08     0.05       0.08      0.05
"Sys.sleep"                       0.08     0.05       0.08      0.05
"try"                             0.06     0.03       1.76      1.03
"[.data.frame"                    0.06     0.03       0.82      0.48
"unique"                          0.06     0.03       0.80      0.47
"getStates"                       0.06     0.03       0.70      0.41
".rate_guess"                     0.06     0.03       0.34      0.20
"Ntip.phylo"                      0.06     0.03       0.28      0.16
"as.matrix.default"               0.06     0.03       0.10      0.06
"close.connection"                0.06     0.03       0.06      0.03
"is.matrix"                       0.06     0.03       0.06      0.03
".sqM1"                           0.04     0.02       6.00      3.50
"resolved"                        0.04     0.02       3.60      2.10
"resolved.ClusterFuture"          0.04     0.02       3.56      2.07
"setNames"                        0.04     0.02       0.70      0.41
"as.vector"                       0.04     0.02       0.52      0.30
"reorderSimmap"                   0.04     0.02       0.18      0.10
"list_apply"                      0.04     0.02       0.10      0.06
"parent.frame"                    0.04     0.02       0.10      0.06
"as.numeric"                      0.04     0.02       0.04      0.02
"min"                             0.04     0.02       0.04      0.02
"reorderRcpp"                     0.04     0.02       0.04      0.02
"serializedSize"                  0.04     0.02       0.04      0.02
"storage.mode"                    0.04     0.02       0.04      0.02
"strheight"                       0.04     0.02       0.04      0.02
"structure"                       0.04     0.02       0.04      0.02
"system"                          0.04     0.02       0.04      0.02
"unique.default"                  0.04     0.02       0.04      0.02
"sapply"                          0.02     0.01       2.22      1.29
"plot.new"                        0.02     0.01       2.08      1.21
"receiveMessageFromWorker"        0.02     0.01       0.86      0.50
"["                               0.02     0.01       0.84      0.49
"Tf2"                             0.02     0.01       0.66      0.38
"mean"                            0.02     0.01       0.40      0.23
"close"                           0.02     0.01       0.08      0.05
"qr"                              0.02     0.01       0.06      0.03
"mdebugf"                         0.02     0.01       0.04      0.02
"qr.default"                      0.02     0.01       0.04      0.02
".Fortran"                        0.02     0.01       0.02      0.01
".get_S3_primitive_generics"      0.02     0.01       0.02      0.01
"anyNA"                           0.02     0.01       0.02      0.01
"as.double"                       0.02     0.01       0.02      0.01
"data.frame"                      0.02     0.01       0.02      0.01
"diff.default"                    0.02     0.01       0.02      0.01
"environment"                     0.02     0.01       0.02      0.01
"formals"                         0.02     0.01       0.02      0.01
"grep"                            0.02     0.01       0.02      0.01
"gsub"                            0.02     0.01       0.02      0.01
"hasArg"                          0.02     0.01       0.02      0.01
"is.atomic"                       0.02     0.01       0.02      0.01
"is.function"                     0.02     0.01       0.02      0.01
"is.list"                         0.02     0.01       0.02      0.01
"is.na"                           0.02     0.01       0.02      0.01
"isFALSE"                         0.02     0.01       0.02      0.01
"isSymmetric.matrix"              0.02     0.01       0.02      0.01
"max"                             0.02     0.01       0.02      0.01
"pmatch"                          0.02     0.01       0.02      0.01
"prop_part2"                      0.02     0.01       0.02      0.01
"stop_if_not"                     0.02     0.01       0.02      0.01
"Sys.info"                        0.02     0.01       0.02      0.01
"text.default"                    0.02     0.01       0.02      0.01

$by.total
total.time total.pct self.time self.pct
"searchOptimalConfiguration"            171.64     99.99      0.00     0.00
"doTryCatch"                            157.46     91.73      0.16     0.09
"tryCatch"                              157.46     91.73      0.14     0.08
"tryCatchList"                          157.46     91.73      0.12     0.07
"tryCatchOne"                           157.46     91.73      0.08     0.05
"withCallingHandlers"                   152.98     89.12      0.00     0.00
"fitMvglsAndExtractGIC.formula"         140.44     81.81      0.00     0.00
"mvgls"                                 132.62     77.26      0.00     0.00
".External2"                            122.14     71.15      2.50     1.46
"<Anonymous>"                           120.38     70.13      0.48     0.28
"optim"                                 119.78     69.78      0.00     0.00
"fn"                                    119.40     69.56      0.92     0.54
".corrStr"                              108.36     63.12      0.12     0.07
".transformTree"                        108.16     63.01      1.02     0.59
"pruning"                                69.66     40.58     66.74    38.88
"crossprod"                              35.52     20.69     35.52    20.69
"future.apply::future_lapply"            16.56      9.65      0.00     0.00
"future_xapply"                          16.56      9.65      0.00     0.00
"FUN"                                    14.42      8.40      0.54     0.31
"lapply"                                 14.34      8.35      0.64     0.37
"serialize"                              12.72      7.41     12.72     7.41
"future"                                 12.66      7.38      0.00     0.00
"launchFuture"                           12.66      7.38      0.00     0.00
"launchFuture.ClusterFutureBackend"      12.66      7.38      0.00     0.00
"node_call_nonblocking"                  12.66      7.38      0.00     0.00
"postNode"                               12.66      7.38      0.00     0.00
"run"                                    12.66      7.38      0.00     0.00
"run.Future"                             12.66      7.38      0.00     0.00
"sendCall"                               12.66      7.38      0.00     0.00
"sendData"                               12.66      7.38      0.00     0.00
"sendData.SOCK0node"                     12.66      7.38      0.00     0.00
"suppressWarnings"                       12.66      7.38      0.00     0.00
".startGuess"                            12.58      7.33      0.00     0.00
"start_values"                           11.78      6.86      0.00     0.00
"drop.tip.simmap"                        11.28      6.57      2.06     1.20
"drop.tip"                               11.28      6.57      0.00     0.00
"plotSimmap"                             11.14      6.49      0.00     0.00
"plotPhylogram"                          11.12      6.48      0.82     0.48
"GIC"                                     7.62      4.44      0.00     0.00
"GIC.mvgls"                               7.62      4.44      0.00     0.00
"lines"                                   7.04      4.10      0.40     0.23
".Call"                                   6.46      3.76      6.46     3.76
".rs.GEcopyDisplayList"                   6.46      3.76      0.00     0.00
"lines.default"                           6.22      3.62      0.14     0.08
"plot.xy"                                 6.08      3.54      2.98     1.74
".sqM1"                                   6.00      3.50      0.04     0.02
"$"                                       4.78      2.78      2.72     1.58
"pseudoinverse"                           4.16      2.42      0.14     0.08
"eigen"                                   4.08      2.38      3.96     2.31
"standardGeneric"                         3.94      2.30      0.72     0.42
"fast.svd"                                3.74      2.18      0.20     0.12
"value"                                   3.74      2.18      0.00     0.00
"value.list"                              3.74      2.18      0.00     0.00
"resolved"                                3.60      2.10      0.04     0.02
"resolved.ClusterFuture"                  3.56      2.07      0.04     0.02
"psmall.svd"                              3.54      2.06      0.36     0.21
"%*%"                                     3.28      1.91      3.28     1.91
"socketSelect"                            3.00      1.75      3.00     1.75
"svd"                                     2.80      1.63      0.40     0.23
"t"                                       2.76      1.61      1.20     0.70
"backsolve"                               2.72      1.58      0.22     0.13
"base::backsolve"                         2.50      1.46      0.90     0.52
"sapply"                                  2.22      1.29      0.02     0.01
"plot.new"                                2.08      1.21      0.02     0.01
"par"                                     1.92      1.12      0.36     0.21
"try"                                     1.76      1.03      0.06     0.03
".rs.saveGraphics"                        1.68      0.98      0.00     0.00
"La.svd"                                  1.62      0.94      0.84     0.49
"apply"                                   1.62      0.94      0.36     0.21
"matrix"                                  1.54      0.90      0.20     0.12
"setdiff"                                 1.52      0.89      0.22     0.13
"save"                                    1.50      0.87      1.34     0.78
"plan"                                    1.28      0.75      0.00     0.00
"plan_set"                                1.28      0.75      0.00     0.00
"which"                                   1.24      0.72      0.80     0.47
"determinant"                             1.18      0.69      0.28     0.16
"is.binary.phylo"                         1.16      0.68      0.46     0.27
"mode<-"                                  1.14      0.66      0.34     0.20
"chol"                                    1.10      0.64      0.32     0.19
"unserialize"                             1.06      0.62      1.06     0.62
"recvData"                                1.06      0.62      0.00     0.00
"recvData.SOCK0node"                      1.06      0.62      0.00     0.00
"as.matrix"                               1.04      0.61      0.86     0.50
"paintSubTree_mod"                        1.04      0.61      0.20     0.12
"addShiftToModel"                         1.04      0.61      0.00     0.00
"$<-"                                     1.02      0.59      0.56     0.33
"unlist"                                  0.94      0.55      0.44     0.26
"diag"                                    0.94      0.55      0.24     0.14
"Ntip"                                    0.90      0.52      0.56     0.33
"xy.coords"                               0.90      0.52      0.30     0.17
"receiveMessageFromWorker"                0.86      0.50      0.02     0.01
"["                                       0.84      0.49      0.02     0.01
"base::determinant"                       0.82      0.48      0.36     0.21
"[.data.frame"                            0.82      0.48      0.06     0.03
"as.list"                                 0.80      0.47      0.62     0.36
"unique"                                  0.80      0.47      0.06     0.03
"t.default"                               0.78      0.45      0.78     0.45
"duplicated"                              0.78      0.45      0.16     0.09
"c"                                       0.74      0.43      0.74     0.43
"ClusterFutureBackend"                    0.72      0.42      0.00     0.00
"clusterRegistry$startCluster"            0.72      0.42      0.00     0.00
"do.call"                                 0.72      0.42      0.00     0.00
"makeFutureBackend"                       0.72      0.42      0.00     0.00
"plan_init"                               0.72      0.42      0.00     0.00
"getStates"                               0.70      0.41      0.06     0.03
"setNames"                                0.70      0.41      0.04     0.02
"get"                                     0.66      0.38      0.10     0.06
"Tf2"                                     0.66      0.38      0.02     0.01
"makeCluster"                             0.64      0.37      0.00     0.00
"generatePaintedTrees"                    0.56      0.33      0.00     0.00
"plan_cleanup"                            0.56      0.33      0.00     0.00
"paste0"                                  0.54      0.31      0.40     0.23
"clusterRegistry$stopCluster"             0.54      0.31      0.00     0.00
"stopWorkers"                             0.54      0.31      0.00     0.00
"stopWorkers.ClusterFutureBackend"        0.54      0.31      0.00     0.00
"gc"                                      0.52      0.30      0.52     0.30
"chol.default"                            0.52      0.30      0.20     0.12
"as.vector"                               0.52      0.30      0.04     0.02
"tabulate"                                0.46      0.27      0.44     0.26
"paste"                                   0.44      0.26      0.42     0.24
"paintSubTree"                            0.44      0.26      0.14     0.08
"mean"                                    0.40      0.23      0.02     0.01
"%in%"                                    0.38      0.22      0.28     0.16
"duplicated.default"                      0.38      0.22      0.14     0.08
"which.min"                               0.38      0.22      0.00     0.00
".is.rooted_ape"                          0.36      0.21      0.10     0.06
"isTRUE"                                  0.34      0.20      0.30     0.17
".rate_guess"                             0.34      0.20      0.06     0.03
"nrow"                                    0.32      0.19      0.10     0.06
"getDescendants"                          0.32      0.19      0.08     0.05
"sort"                                    0.32      0.19      0.00     0.00
"Ntip.phylo"                              0.28      0.16      0.06     0.03
"ifelse"                                  0.26      0.15      0.14     0.08
"determinant.matrix"                      0.24      0.14      0.22     0.13
"clusterCall"                             0.24      0.14      0.00     0.00
"checkForRemoteErrors"                    0.22      0.13      0.00     0.00
"base::try"                               0.20      0.12      0.00     0.00
"grDevices:::png"                         0.20      0.12      0.00     0.00
"simplify2array"                          0.20      0.12      0.00     0.00
".External"                               0.18      0.10      0.18     0.10
"is.finite"                               0.18      0.10      0.18     0.10
"sum"                                     0.18      0.10      0.18     0.10
".vec"                                    0.18      0.10      0.08     0.05
"reorderSimmap"                           0.18      0.10      0.04     0.02
"grDevices::recordPlot"                   0.18      0.10      0.00     0.00
"rainbow"                                 0.18      0.10      0.00     0.00
"reorder"                                 0.18      0.10      0.00     0.00
"reorder.simmap"                          0.18      0.10      0.00     0.00
"length"                                  0.16      0.09      0.16     0.09
"names"                                   0.14      0.08      0.14     0.08
"strwidth"                                0.14      0.08      0.14     0.08
"getGlobalsAndPackages"                   0.14      0.08      0.00     0.00
"all"                                     0.12      0.07      0.12     0.07
"list"                                    0.12      0.07      0.12     0.07
"ncol"                                    0.12      0.07      0.10     0.06
"findGlobals"                             0.12      0.07      0.00     0.00
"getEligibleNodes"                        0.12      0.07      0.00     0.00
"globalsOf"                               0.12      0.07      0.00     0.00
"nodelabels"                              0.12      0.07      0.00     0.00
"is.factor"                               0.10      0.06      0.10     0.06
"match.fun"                               0.10      0.06      0.08     0.05
"vcv.phylo"                               0.10      0.06      0.08     0.05
"as.matrix.default"                       0.10      0.06      0.06     0.03
"list_apply"                              0.10      0.06      0.04     0.02
"parent.frame"                            0.10      0.06      0.04     0.02
"BOTHlabels"                              0.10      0.06      0.00     0.00
"as.list.default"                         0.08      0.05      0.08     0.05
"attr"                                    0.08      0.05      0.08     0.05
"double"                                  0.08      0.05      0.08     0.05
"gzfile"                                  0.08      0.05      0.08     0.05
"substr"                                  0.08      0.05      0.08     0.05
"Sys.sleep"                               0.08      0.05      0.08     0.05
"close"                                   0.08      0.05      0.02     0.01
"reorder.phylo"                           0.08      0.05      0.00     0.00
"close.connection"                        0.06      0.03      0.06     0.03
"is.matrix"                               0.06      0.03      0.06     0.03
"qr"                                      0.06      0.03      0.02     0.01
"digest"                                  0.06      0.03      0.00     0.00
"getGlobalsAndPackagesXApply"             0.06      0.03      0.00     0.00
"md5"                                     0.06      0.03      0.00     0.00
"uuid"                                    0.06      0.03      0.00     0.00
"as.numeric"                              0.04      0.02      0.04     0.02
"min"                                     0.04      0.02      0.04     0.02
"reorderRcpp"                             0.04      0.02      0.04     0.02
"serializedSize"                          0.04      0.02      0.04     0.02
"storage.mode"                            0.04      0.02      0.04     0.02
"strheight"                               0.04      0.02      0.04     0.02
"structure"                               0.04      0.02      0.04     0.02
"system"                                  0.04      0.02      0.04     0.02
"unique.default"                          0.04      0.02      0.04     0.02
"mdebugf"                                 0.04      0.02      0.02     0.01
"qr.default"                              0.04      0.02      0.02     0.01
".length"                                 0.04      0.02      0.00     0.00
".penalizedCov"                           0.04      0.02      0.00     0.00
".reorder_ape"                            0.04      0.02      0.00     0.00
"getS3method"                             0.04      0.02      0.00     0.00
".Fortran"                                0.02      0.01      0.02     0.01
".get_S3_primitive_generics"              0.02      0.01      0.02     0.01
"anyNA"                                   0.02      0.01      0.02     0.01
"as.double"                               0.02      0.01      0.02     0.01
"data.frame"                              0.02      0.01      0.02     0.01
"diff.default"                            0.02      0.01      0.02     0.01
"environment"                             0.02      0.01      0.02     0.01
"formals"                                 0.02      0.01      0.02     0.01
"grep"                                    0.02      0.01      0.02     0.01
"gsub"                                    0.02      0.01      0.02     0.01
"hasArg"                                  0.02      0.01      0.02     0.01
"is.atomic"                               0.02      0.01      0.02     0.01
"is.function"                             0.02      0.01      0.02     0.01
"is.list"                                 0.02      0.01      0.02     0.01
"is.na"                                   0.02      0.01      0.02     0.01
"isFALSE"                                 0.02      0.01      0.02     0.01
"isSymmetric.matrix"                      0.02      0.01      0.02     0.01
"max"                                     0.02      0.01      0.02     0.01
"pmatch"                                  0.02      0.01      0.02     0.01
"prop_part2"                              0.02      0.01      0.02     0.01
"stop_if_not"                             0.02      0.01      0.02     0.01
"Sys.info"                                0.02      0.01      0.02     0.01
"text.default"                            0.02      0.01      0.02     0.01
".make_numeric_version"                   0.02      0.01      0.00     0.00
".rangeNum"                               0.02      0.01      0.00     0.00
".rs.graphics.supportedBackends"          0.02      0.01      0.00     0.00
".targetM"                                0.02      0.01      0.00     0.00
"add_cluster_session_info"                0.02      0.01      0.00     0.00
"capture.output"                          0.02      0.01      0.00     0.00
"checkIntFormat"                          0.02      0.01      0.00     0.00
"clusterEvalQ"                            0.02      0.01      0.00     0.00
"connectionId"                            0.02      0.01      0.00     0.00
"connectionInfo"                          0.02      0.01      0.00     0.00
"defaultCluster"                          0.02      0.01      0.00     0.00
"deparse"                                 0.02      0.01      0.00     0.00
"deparse1"                                0.02      0.01      0.00     0.00
"dframe"                                  0.02      0.01      0.00     0.00
"diff"                                    0.02      0.01      0.00     0.00
"findGlobals_dfs"                         0.02      0.01      0.00     0.00
"findGlobals_dfs_call"                    0.02      0.01      0.00     0.00
"findGlobals_dfs_function"                0.02      0.01      0.00     0.00
"findGlobalsDFS"                          0.02      0.01      0.00     0.00
"getRversion"                             0.02      0.01      0.00     0.00
"is.rooted"                               0.02      0.01      0.00     0.00
"isConnectionValid"                       0.02      0.01      0.00     0.00
"makeNode"                                0.02      0.01      0.00     0.00
"match.arg"                               0.02      0.01      0.00     0.00
"model.frame"                             0.02      0.01      0.00     0.00
"model.frame.default"                     0.02      0.01      0.00     0.00
"na.omit"                                 0.02      0.01      0.00     0.00
"na.omit.data.frame"                      0.02      0.01      0.00     0.00
"objectSize"                              0.02      0.01      0.00     0.00
"optimize"                                0.02      0.01      0.00     0.00
"package_version"                         0.02      0.01      0.00     0.00

$sample.interval
[1] 0.02

$sampling.time
[1] 171.66
'''
