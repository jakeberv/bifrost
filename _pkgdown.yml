url: ~
template:
  bootstrap: 5
  includes:
    after_body: |
      <script type="module">
      // Load a pinned, stable Mermaid (v10) and force it to be the one we use.
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.esm.min.mjs?v=1091';
      window.mermaid = mermaid;

      (function initMermaid() {
        const run = () => {
          // Find mermaid code blocks produced by pkgdown/pandoc (covers multiple shapes)
          const sels = [
            'pre code.language-mermaid',
            'pre code.mermaid',
            'pre.mermaid',
            'code.mermaid',
            'div.sourceCode pre code.language-mermaid',
            'div.sourceCode pre code.mermaid'
          ];
          const nodes = new Set();
          sels.forEach(sel => document.querySelectorAll(sel).forEach(el => nodes.add(el)));

          nodes.forEach(code => {
            const pre = code.closest('pre') || code;
            const div = document.createElement('div');
            div.className = 'mermaid';
            div.textContent = (code.textContent || code.innerText || '').trim(); // important
            pre.replaceWith(div);
          });

          mermaid.initialize({ startOnLoad: false });
          mermaid.run({ querySelector: '.mermaid' });
        };

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', run);
        } else {
          run();
        }
      })();
      </script>
